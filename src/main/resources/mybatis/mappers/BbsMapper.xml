<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.recipe.gola.mapper.BbsMapper">

	<!-- 게시판 저장 -->
    <insert id="insertBbs" parameterType="BbsDTO">
	    <selectKey resultType="string" 	keyProperty="bno" order="BEFORE">
	        SELECT 
	        	IFNULL(MAX(bno) + 1, 1) as bno
	        FROM board /*프라이머리키 1씩 증가시키기*/
	    </selectKey> 
		INSERT INTO board
        (
        	bno
        	, title
        	, content
        	, writer
        	, reg_date
        )
        VALUES
      	(
      		#{bno}				/*게시판 프라이머리 키*/
        	, #{title}				/*게시판제목*/
            , #{content}		/*게시판내용*/
            , #{writer}			/*작성자*/
            , now()				/*작성일*/
      	)
    </insert>

	<!-- 게시판 목록조회 -->
    <select id="selectListBbs" resultType="BbsDTO">
        SELECT 
        	bno
        	, title
        	, content
        	, writer
        	, view_cnt
        	, comment_cnt
        	, date_format(reg_date, '%Y-%m-%d') as reg_date
        FROM board
        ORDER BY reg_date DESC, bno DESC
    </select>

	<!-- 게시판상세조회 -->
    <select id="selectDetailBbs" parameterType="BbsDTO" resultType="BbsDTO">
        SELECT 
        	bno
        	, title
        	, content
        	, writer
        	, view_cnt
        	, comment_cnt
        	, date_format(reg_date, '%Y-%m-%d') as reg_date
        FROM board
        WHERE bno = #{bno}
    </select>

	<!-- 게시판 수정 -->
    <update id="updateBbs" parameterType="BbsDTO">
        UPDATE board
        SET   
        	title = #{title}
          	, content = #{content}
          	, up_date = now()
        WHERE bno = #{bno}
    </update>

	<!-- 게시판 삭제 -->
    <delete id="deleteBbs" parameterType="BbsDTO">
   		DELETE FROM board 
   		WHERE bno = #{bno} 
    </delete>
    
</mapper>