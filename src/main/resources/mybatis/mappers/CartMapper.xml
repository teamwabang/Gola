<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.recipe.gola.mapper.CartMapper">

	<!-- 내가 담은 장바구니 목록 조회 -->
	<select id="list" parameterType="String" resultType="CartDTO">
	<![CDATA[
		SELECT *
		FROM cart
		WHERE userId = #{userId}
	]]>
	</select>
	
	<!-- 장바구니에 물건 담기 -->
	<insert id="insert" parameterType="CartDTO">
	<![CDATA[
		INSERT INTO 
		cart (cno, userId, pno, cQuantity)
        VALUES (cno, #{userId}, #{pno}, #{cQuantity})
    ]]>
    </insert>
    
    <!-- 장바구니에 동일한 상품이 있는지 확인 -->
    <select id="countCart" resultType="int">
    <![CDATA[
    	SELECT COUNT(*)
    	FROM cart
    	WHERE userId = #{userId}
    	AND pno = #{pno}
    ]]>
    </select>
    
    <!-- 장바구니에 동일한 상품이 존재하면 수정 -->
    <update id="update">
    <![CDATA[
    	UPDATE cart
    	SET cQuantity = cQuantity + #{cQuantity}
    	WHERE userId = #{userId}
    	AND pno = #{pno}
    ]]>
    </update>
    
    <!-- 장바구니 전체 금액 -->
    <select id="sumMoney" resultType="int">
    <![CDATA[
    	SELECT SUM(pPrice * cQuantity)
    	FROM product p, cart c
    	WHERE c.pno = p.pno AND c.userId = #{userId}
    ]]>
    </select>
  
</mapper>