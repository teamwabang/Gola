<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
 <!-- CSS -->
    <link rel="stylesheet" href="/css/styles.css" />
<body>
	<div th:fragment="fr_NickNameModal">
	<!-- pw edit Modal -->
	    <div class="modal fade" id="nickNameChange" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">닉네임 변경</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="input-group input-group-sm mb-3">      
	       	<!-- 닉네임 변경 시작 -->
	      	<div id="change-nickname-area">
	      	<form th:name="form2" th:onsubmit="return submitCheck(form2);" method="post">
	      		<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
		    	<input type="hidden" name="userId" th:value="${dto.getUserId() }" readonly><br>
<<<<<<< Updated upstream
		    	<input type="text" id="userNicknameedit" name="userNickname" placeholder="변경할 닉네임을 입력하세요."><br>
		    	<button type="button" class="nicknameCheck" onclick="nicknameCheck();" value="N">중복확인</button>
		  		   <p id="userNicknameCheck"></p>
=======
		    	<!-- 변경할 닉네임 입력  -->
		    	<input type="text" id="userNicknameedit" name="userNickname" onkeyup="nickCheckInit(form2);" placeholder="변경할 닉네임을 입력하세요.">
		  		<!-- 중복확인 -->
		  		<button type="button" id="doublecheck-nickname-btn" class="nicknameCheck" onclick="nicknameCheck(form2);" value="N">중복확인</button>
		  		<input type="hidden" name="nickCheckResult" value="0" />
		  		<!-- 유효성 검사문구 -->
		  		<p id="userNicknameCheck"></p>
		    	<!-- 변경 submit -->
>>>>>>> Stashed changes
		    	<input type="button" id="change-nickname-btn" value="변경">
			</form>
			</div>
			<!-- 닉네임 변경 끝 -->
          </div>
        </div>
      </div>
    </div>
	</div>
	</div>
	
	<script type="text/javascript">
		
		/*닉에임 유효성 검사*/
		$('#userNicknameedit').on('keyup' ,function() {
			  if (!/^[가-힣a-zA-Z0-9]{3,20}$/g.test($('#userNicknameedit').val())) {
			    $('#userNicknameCheck').css({
			      "color" : "red"
			    });
			    $('#userNicknameCheck').html("닉네임은 특수문자를 제외한 3~20자리로 입력해주세요.");
			    $('#userNicknameCheck').show();
			  } else {
			    $('#userNicknameCheck').css({
			      "color" : "blue"
			    });
			      $('#userNicknameCheck').html("사용 가능한 닉네임입니다.");
			      $('#userNicknameCheck').show();
			  }
			});
		
		/*닉네임 중복확인 클릭여부*/
		let cnt = 0;
		
		$(function() { 
			$("#doublecheck-nickname-btn").click(function() {
				cnt+=1;
			});
		});
		
		/*id를 변경한 경우 다시 검사하도록
		function nickCheckInit(form2) {
			if(form2.nickCheckResult.value=="1") {
				form2.nickCheckResult.value="0";
			}
		}
		*/
		
		
		
		/*닉네임 중복확인*/
		function nicknameCheck(){
			$.ajax({
				url : "/nicknameCheck",
				type : "post",
				dataType : "json",
				data : {"userNickname" : $("#userNicknameedit").val()},
				success : function(data) {
					if(data == 1) {
			          alert("이미 사용하고 있는 닉네임입니다.");
			        } else if(data == 0) {
			          $("#nicknameCheck").attr("value", "Y");
			          alert("변경 가능한 닉네임입니다.");
			        }
			    }
			})
		}
		

		/*submit버튼 유효성*/
		$(function() {
			$("#change-nickname-btn").click(function() {
				if(!/^[가-힣a-zA-Z0-9]{3,20}$/g.test($('#userNicknameedit').val())) {
					confirm("알맞은 닉네임 형식으로 입력해주세요");
				}/*else if(form2.nickCheckResult.value=="0") {
					alert("아이디 입력 후 중복확인 버튼을 눌러주세요.");
					return false;
				}*/
					else if (!cnt>0) {
					alert("중복확인 버튼을 눌러주세요.");
					return false;
				 }else if (confirm("회원정보를 수정하시겠습니까?")) {
		    		// 폼 내부의 데이터를 전송할 주소
		    		document.form2.action="mypage/modify/nickname";
		    		document.form2.submit();	// 제출
	    		}
			});
		});

		



		
	</script>
</body>
</html>